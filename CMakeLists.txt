# Copyright (c) Facebook, Inc. and its affiliates.
# All rights reserved.
#
# This source code is licensed under the BSD-style license found in the
# LICENSE file in the root directory of this source tree.

# CMake 3.10 is the version available in Ubuntu 18.04.
cmake_minimum_required(VERSION 3.10 FATAL_ERROR)

project(tensorpipe C CXX)
set(CMAKE_CXX_STANDARD 14)

list(APPEND CMAKE_MODULE_PATH "${PROJECT_SOURCE_DIR}/cmake")

if(CMAKE_SYSTEM_NAME STREQUAL "Linux")
  set(LINUX ON)
else()
  set(LINUX OFF)
endif()

option(TP_ENABLE_SHM "Enable shm transport" ${LINUX})
option(TP_ENABLE_CMA "Enable cma channel" ${LINUX})
option(TP_BUILD_LIBUV "Build libuv from source" OFF)

# Define sanitizer option, if specified.
include(Sanitize)

# We use the [[nodiscard]] attribute, which GCC 5 complains about.
# Silence this warning if GCC 5 is used.
if(CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
  if(CMAKE_CXX_COMPILER_VERSION VERSION_LESS 6)
    add_definitions("-Wno-attributes")
  endif()
endif()

# CTest must be included in the top level to enable `make test` target.
include(CTest)

if(BUILD_TESTING)
  add_subdirectory(third_party/googletest EXCLUDE_FROM_ALL)
endif()

if(BUILD_PYTHON_MODULE)
  add_subdirectory(third_party/pybind11 EXCLUDE_FROM_ALL)
endif()

add_subdirectory(tensorpipe)
